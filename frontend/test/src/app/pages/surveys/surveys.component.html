<div class="surveys-page">
  <div class="page-header-section">
    <div class="header-content">
      <h1 class="page-header">Assessment</h1>
      <p class="page-subtitle">Ermitteln Sie die Change-Readiness Ihrer Organisation</p>
    </div>
  </div>

  <!-- Assessment Start Screen -->
  <div class="assessment-start-section">
    <mat-card class="assessment-intro-card">
      <div class="intro-content">
        <mat-icon class="intro-icon">assignment_turned_in</mat-icon>
        <h2 class="intro-title">Assessment starten</h2>
        <p class="intro-description">
          {{ getTotalQuestions() }} Fragen in {{ getTotalCategories() }} Bereichen nach dem ADKAR-Modell. 
          Sie können jederzeit unterbrechen und später fortfahren.
        </p>
      </div>
    </mat-card>
  </div>

  <!-- ADKAR-Bereiche Cards -->
  <div class="adkar-areas-section">
    <div class="adkar-grid">
      <mat-card class="adkar-card">
        <div class="adkar-content">
          <mat-icon class="adkar-icon">info</mat-icon>
          <h3 class="adkar-title">Wissen</h3>
          <p class="adkar-questions">{{ getQuestionsForAdkarArea('KNOWLEDGE') }} Fragen</p>
        </div>
      </mat-card>
      <mat-card class="adkar-card">
        <div class="adkar-content">
          <mat-icon class="adkar-icon">bolt</mat-icon>
          <h3 class="adkar-title">Fähigkeit</h3>
          <p class="adkar-questions">{{ getQuestionsForAdkarArea('ABILITY') }} Fragen</p>
        </div>
      </mat-card>
      <mat-card class="adkar-card">
        <div class="adkar-content">
          <mat-icon class="adkar-icon">flag</mat-icon>
          <h3 class="adkar-title">Motivation</h3>
          <p class="adkar-questions">{{ getQuestionsForAdkarArea('DESIRE') }} Fragen</p>
        </div>
      </mat-card>
      <mat-card class="adkar-card">
        <div class="adkar-content">
          <mat-icon class="adkar-icon">people</mat-icon>
          <h3 class="adkar-title">Kommunikation</h3>
          <p class="adkar-questions">{{ getQuestionsForAdkarArea('REINFORCEMENT') }} Fragen</p>
        </div>
      </mat-card>
    </div>
  </div>

  <!-- Assessment Info -->
  <div class="assessment-info-section">
    <mat-card class="info-card">
      <div class="info-content">
        <div class="info-item">
          <mat-icon class="info-icon">schedule</mat-icon>
          <span class="info-text">Geschätzte Dauer: ca. {{ getEstimatedDuration() }} Minuten</span>
        </div>
        <div class="info-item">
          <mat-icon class="info-icon">save</mat-icon>
          <span class="info-text">Zwischenspeicherung möglich</span>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Assessment Start Button -->
  <div class="assessment-start-section">
    @if (activeTemplates().length > 0) {
      <button 
        mat-raised-button 
        class="start-button" 
        (click)="startAssessment()"
        [disabled]="isLoading()">
        <mat-icon>play_arrow</mat-icon>
        Assessment starten
      </button>
    }
  </div>

  @if (isLoading()) {
    <div class="loading">Lade Umfragen...</div>
  } @else {
    @if (activeTemplates().length === 0) {
      <section class="section">
        <h2>Umfragen</h2>
        <p class="empty-state">Noch keine Umfragen vorhanden.</p>
      </section>
    }
    <!-- Offene Umfragen -->
    @if (getOpenInstances().length > 0) {
      <section class="section">
        <h2>Offene Umfragen</h2>
        <div class="survey-grid">
          @for (instance of getOpenInstances(); track instance.id) {
            <mat-card class="survey-card">
              <mat-card-header>
                <mat-card-title>{{ instance.template.name }}</mat-card-title>
                <mat-card-subtitle>{{ instance.template.description }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="survey-info">
                  <span class="status-chip" [class]="getInstanceStatus(instance).color">
                    {{ getInstanceStatus(instance).label }}
                  </span>
                </div>
              </mat-card-content>
              <mat-card-actions>
                <button mat-raised-button color="primary" [routerLink]="['/app/survey', instance.id, 'fill']">
                  <mat-icon>edit</mat-icon>
                  Weiter bearbeiten
                </button>
                <button
                  mat-icon-button
                  class="delete-instance-btn"
                  color="warn"
                  [disabled]="isDeleting()"
                  (click)="confirmDeleteInstance(instance)"
                  aria-label="Umfrage löschen">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card-actions>
            </mat-card>
          }
        </div>
      </section>
    }

    <!-- Abgeschlossene Umfragen -->
    @if (getCompletedInstances().length > 0) {
      <section class="section">
        <h2>Abgeschlossene Umfragen</h2>
        <div class="survey-grid">
          @for (instance of getCompletedInstances(); track instance.id) {
            <mat-card class="survey-card completed">
              <mat-card-header>
                <mat-card-title>{{ instance.template.name }}</mat-card-title>
                <mat-card-subtitle>
                  Abgeschlossen am {{ instance.submittedAt | date:'medium':'de' }}
                </mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="survey-info">
                  <span class="status-chip primary">Abgeschlossen</span>
                </div>
              </mat-card-content>
              <mat-card-actions>
                <button mat-raised-button color="primary" [routerLink]="['/app/survey', instance.id, 'summary']">
                  <mat-icon>visibility</mat-icon>
                  Zusammenfassung anzeigen
                </button>
                <button
                  mat-icon-button
                  class="delete-instance-btn"
                  color="warn"
                  [disabled]="isDeleting()"
                  (click)="confirmDeleteInstance(instance)"
                  aria-label="Umfrage löschen">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card-actions>
            </mat-card>
          }
        </div>
      </section>
    }

    @if (getOpenInstances().length === 0 && activeTemplates().length === 0 && getCompletedInstances().length === 0) {
      <mat-card>
        <mat-card-content>
          <p>Keine Umfragen verfügbar.</p>
        </mat-card-content>
      </mat-card>
    }
  }
</div>

