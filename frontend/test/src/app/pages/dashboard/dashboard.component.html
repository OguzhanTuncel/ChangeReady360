<div class="dashboard-page">
  <h1 class="page-header">Change-Readiness Dashboard</h1>
  <p class="page-subtitle">{{ getCurrentDate() }}</p>

  @if (isLoading()) {
    <div class="loading">Lade Dashboard...</div>
  } @else {
    <!-- KPI Cards Top Row -->
    <div class="kpi-cards-grid">
      @for (card of kpiCards; track card.title) {
        <mat-card class="kpi-card" [class.clickable]="card.route" (click)="card.route && navigateToCard(card.route)">
          <div class="kpi-content">
            <div class="kpi-header">
              <mat-icon class="kpi-icon">{{ card.icon }}</mat-icon>
              <span class="kpi-title">{{ card.title }}</span>
            </div>
            <div class="kpi-value">{{ card.value }}</div>
            @if (card.change) {
              <div class="kpi-change" [class.positive]="card.change.startsWith('+')" [class.negative]="card.change.startsWith('-')">
                {{ card.change }}
              </div>
            } @else if (card.title === 'Stakeholder' && kpis()?.stakeholderGroupsCount) {
              <div class="kpi-subtitle">in {{ kpis()!.stakeholderGroupsCount }} Gruppen</div>
            } @else if (card.title === 'Kritiker' && kpis()?.criticsCount && kpis()!.criticsCount > 0) {
              <div class="kpi-subtitle">benötigen Aufmerksamkeit</div>
            } @else if (card.title === 'Offene Maßnahmen' && kpis()?.overdueMeasuresCount && kpis()!.overdueMeasuresCount > 0) {
              <div class="kpi-subtitle">davon {{ kpis()!.overdueMeasuresCount }} überfällig</div>
            }
          </div>
        </mat-card>
      }
    </div>

    <!-- Main Content Grid -->
    <div class="main-content-grid">
      <!-- Gesamt-Readiness Card -->
      <mat-card class="readiness-card">
        <mat-card-header>
          <mat-card-title>Gesamt-Readiness</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          @if (readinessData()) {
            <div class="readiness-content">
              <div class="donut-wrapper">
                <app-donut-chart 
                  [value]="readinessData()!.overallReadiness" 
                  [size]="220" 
                  [strokeWidth]="28">
                </app-donut-chart>
              </div>
              <div class="readiness-stats">
                <div class="stat-item promoter">
                  <span class="stat-count">{{ readinessData()!.promoters }}</span>
                  <span class="stat-label">Promoter</span>
                </div>
                <div class="stat-item neutral">
                  <span class="stat-count">{{ readinessData()!.neutrals }}</span>
                  <span class="stat-label">Neutral</span>
                </div>
                <div class="stat-item critic">
                  <span class="stat-count">{{ readinessData()!.critics }}</span>
                  <span class="stat-label">Kritiker</span>
                </div>
              </div>
            </div>
          } @else {
            <div class="empty-readiness">
              <p>Noch keine Readiness-Daten verfügbar</p>
            </div>
          }
        </mat-card-content>
      </mat-card>
    <div class="content-grid">
      <!-- Open Surveys -->
      <mat-card class="content-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>event</mat-icon>
            Offene Umfragen
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="empty-state-surveys">
            <div class="clipboard-illustration">
              <svg width="110" height="110" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="30" y="20" width="60" height="80" rx="4" fill="#E5E5E5" stroke="#D4D4D4" stroke-width="2"/>
                <line x1="40" y1="35" x2="80" y2="35" stroke="#A3A3A3" stroke-width="2" stroke-linecap="round"/>
                <line x1="40" y1="50" x2="80" y2="50" stroke="#A3A3A3" stroke-width="2" stroke-linecap="round"/>
                <line x1="40" y1="65" x2="80" y2="65" stroke="#A3A3A3" stroke-width="2" stroke-linecap="round"/>
                <circle cx="85" cy="85" r="12" fill="#31749B"/>
                <line x1="85" y1="79" x2="85" y2="91" stroke="white" stroke-width="2" stroke-linecap="round"/>
                <line x1="79" y1="85" x2="91" y2="85" stroke="white" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
            <p class="empty-text">Derzeit sind keine offenen Umfragen verfügbar.</p>
            <button mat-raised-button color="primary" routerLink="/app/surveys" class="start-survey-button">
              Neue Umfrage starten
            </button>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Recent Activities -->
      <mat-card class="content-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>schedule</mat-icon>
            Letzte Aktivitäten
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="activity-stats">
            <div class="activity-stat-item">
              <mat-icon>event</mat-icon>
              <span>{{ getActivityCount('survey') }} Umfragen gestartet</span>
            </div>
            <div class="activity-stat-item">
              <mat-icon>bar_chart</mat-icon>
              <span>{{ getActivityCount('result') }} Analysen abgesgangen</span>
            </div>
            <div class="activity-stat-item">
              <mat-icon>people</mat-icon>
              <span>{{ responses().length }} Antworten insgesamt</span>
            </div>
            <div class="activity-empty-text">Bisher keine Aktivitäten</div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  }
</div>

