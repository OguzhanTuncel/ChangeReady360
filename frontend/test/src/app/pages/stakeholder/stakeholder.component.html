<div class="stakeholder-page">
  <div class="page-header-section">
    <div class="header-content">
      <h1 class="page-header">Stakeholder-Management</h1>
      <p class="page-subtitle">Übersicht aller betroffenen Gruppen und deren Change-Readiness</p>
    </div>
    <button mat-raised-button color="primary" class="add-button" (click)="addStakeholder()">
      <mat-icon>add</mat-icon>
      Stakeholder hinzufügen
    </button>
  </div>

  @if (isLoading()) {
    <div class="loading">Lade Stakeholder-Daten...</div>
  } @else {
    <!-- KPI Cards -->
    <div class="kpi-cards-grid">
      <mat-card class="kpi-card">
        <div class="kpi-content">
          <div class="kpi-header">
            <span class="kpi-title">Gesamt</span>
          </div>
          <div class="kpi-value">{{ stakeholderKpis()?.total || 0 }}</div>
        </div>
      </mat-card>
      <mat-card class="kpi-card promoter-card">
        <div class="kpi-content">
          <div class="kpi-header">
            <span class="kpi-title">Promoter</span>
          </div>
          <div class="kpi-value promoter-value">{{ stakeholderKpis()?.promoters || 0 }}</div>
        </div>
      </mat-card>
      <mat-card class="kpi-card neutral-card">
        <div class="kpi-content">
          <div class="kpi-header">
            <span class="kpi-title">Neutral</span>
          </div>
          <div class="kpi-value neutral-value">{{ stakeholderKpis()?.neutrals || 0 }}</div>
        </div>
      </mat-card>
      <mat-card class="kpi-card critic-card">
        <div class="kpi-content">
          <div class="kpi-header">
            <span class="kpi-title">Kritiker</span>
          </div>
          <div class="kpi-value critic-value">{{ stakeholderKpis()?.critics || 0 }}</div>
        </div>
      </mat-card>
    </div>
    <!-- Aktuell ausgewähltes Unternehmen -->
    @if (selectedCompany()) {
      <mat-card class="selected-company-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>business</mat-icon>
            Aktuelles Unternehmen
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="selected-company-info">
            <h2>{{ selectedCompany()!.name }}</h2>
            <p class="company-status">Aktiv</p>
          </div>
        </mat-card-content>
      </mat-card>
    }

    <!-- Unternehmen-Liste -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>Unternehmen verwalten</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="companies-list">
          @for (company of companies(); track company.id) {
            <div 
              class="company-item" 
              [class.selected]="selectedCompany()?.id === company.id"
              (click)="selectCompany(company)"
            >
              <div class="company-info">
                <h3>{{ company.name }}</h3>
                <p class="company-meta">
                  @if (selectedCompany()?.id === company.id) {
                    <span class="badge-active">Aktuell ausgewählt</span>
                  }
                </p>
              </div>
              <mat-icon>chevron_right</mat-icon>
            </div>
          }
        </div>

        <!-- Neues Unternehmen hinzufügen -->
        @if (showAddForm()) {
          <div class="add-company-form">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Unternehmensname</mat-label>
              <input 
                matInput 
                [(ngModel)]="newCompanyName"
                (keyup.enter)="createCompany()"
                placeholder="z.B. Beispiel GmbH"
              />
            </mat-form-field>
            <div class="form-actions">
              <button mat-raised-button color="primary" (click)="createCompany()" [disabled]="!newCompanyName.trim()">
                Unternehmen erstellen
              </button>
              <button mat-button (click)="cancelAdd()">Abbrechen</button>
            </div>
          </div>
        } @else {
          <button mat-raised-button color="primary" class="add-button" (click)="toggleAddForm()">
            <mat-icon>add</mat-icon>
            Neues Unternehmen hinzufügen
          </button>
        }
      </mat-card-content>
    </mat-card>
  }
</div>

