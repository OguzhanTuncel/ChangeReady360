<div class="stakeholder-page">
  @if (showDetailView() && selectedGroup()) {
    <!-- Detail View -->
    <div class="detail-view">
      <button mat-button class="back-button" (click)="backToOverview()">
        <mat-icon>arrow_back</mat-icon>
        Zurück zur Übersicht
      </button>
      
      <div class="detail-header">
        <mat-icon class="detail-icon">{{ selectedGroup()!.icon }}</mat-icon>
        <div class="detail-title-section">
          <h1 class="detail-title">{{ selectedGroup()!.name }}</h1>
          <p class="detail-impact">Betroffenheit: {{ getImpactText(selectedGroup()!.impact) }}</p>
        </div>
        <span class="status-badge" [class]="getStatusBadgeClass(selectedGroup()!.status)">
          {{ getStatusBadgeText(selectedGroup()!.status) }}
        </span>
      </div>

      <div class="detail-stats-grid">
        <mat-card class="stat-card">
          <div class="stat-content">
            <span class="stat-label">Promoter</span>
            <span class="stat-value promoter-value">{{ selectedGroup()!.promoters }}</span>
          </div>
        </mat-card>
        <mat-card class="stat-card">
          <div class="stat-content">
            <span class="stat-label">Neutral</span>
            <span class="stat-value neutral-value">{{ selectedGroup()!.neutrals }}</span>
          </div>
        </mat-card>
        <mat-card class="stat-card">
          <div class="stat-content">
            <span class="stat-label">Kritiker</span>
            <span class="stat-value critic-value">{{ selectedGroup()!.critics }}</span>
          </div>
        </mat-card>
      </div>

      <mat-card class="readiness-gauge-card">
        <mat-card-header>
          <mat-card-title>Readiness</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="gauge-wrapper">
            <app-donut-chart 
              [value]="selectedGroup()!.readiness" 
              [size]="200" 
              [strokeWidth]="24">
            </app-donut-chart>
            <div class="gauge-label">{{ selectedGroup()!.readiness }}%</div>
          </div>
        </mat-card-content>
      </mat-card>

      @if (groupPersons().length > 0) {
        <mat-card class="persons-card">
          <mat-card-header>
            <mat-card-title>Stakeholder-Personen</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="persons-list">
              @for (person of groupPersons(); track person.id) {
                <div class="person-item">
                  <div class="person-info">
                    <span class="person-name">{{ person.name }}</span>
                    @if (person.role) {
                      <span class="person-role">{{ person.role }}</span>
                    }
                  </div>
                  <span class="person-category" [class]="'category-' + person.category">
                    {{ person.category === 'promoter' ? 'Promoter' : person.category === 'neutral' ? 'Neutral' : 'Kritiker' }}
                  </span>
                </div>
              }
            </div>
          </mat-card-content>
        </mat-card>
      } @else {
        <mat-card class="empty-persons-card">
          <mat-card-content>
            <p>Noch keine Stakeholder-Personen verfügbar</p>
          </mat-card-content>
        </mat-card>
      }
    </div>
  } @else {
    <!-- Overview View -->
    <div class="overview-view">
      <div class="page-header-section">
        <div class="header-content">
          <h1 class="page-header">Stakeholder-Management</h1>
          <p class="page-subtitle">Übersicht aller betroffenen Gruppen und deren Change-Readiness</p>
        </div>
        <button mat-raised-button color="primary" class="add-button" (click)="addStakeholder()">
          <mat-icon>add</mat-icon>
          Stakeholder hinzufügen
        </button>
      </div>

      @if (isLoading()) {
        <div class="loading">Lade Stakeholder-Daten...</div>
      } @else {
    <!-- KPI Cards -->
    @if (stakeholderKpis()) {
      <div class="kpi-cards-grid">
        <mat-card class="kpi-card">
          <div class="kpi-content">
            <div class="kpi-header">
              <span class="kpi-title">Gesamt</span>
            </div>
            <div class="kpi-value">{{ stakeholderKpis()!.total }}</div>
          </div>
        </mat-card>
      <mat-card class="kpi-card promoter-card">
        <div class="kpi-content">
          <div class="kpi-header">
            <span class="kpi-title">Promoter</span>
          </div>
          <div class="kpi-value promoter-value">{{ stakeholderKpis()!.promoters }}</div>
        </div>
      </mat-card>
      <mat-card class="kpi-card neutral-card">
        <div class="kpi-content">
          <div class="kpi-header">
            <span class="kpi-title">Neutral</span>
          </div>
          <div class="kpi-value neutral-value">{{ stakeholderKpis()!.neutrals }}</div>
        </div>
      </mat-card>
      <mat-card class="kpi-card critic-card">
        <div class="kpi-content">
          <div class="kpi-header">
            <span class="kpi-title">Kritiker</span>
          </div>
          <div class="kpi-value critic-value">{{ stakeholderKpis()!.critics }}</div>
        </div>
        </mat-card>
        </div>
      } @else {
        <div class="empty-kpis-message">
          <p>Keine Stakeholder-KPI-Daten verfügbar</p>
        </div>
      }

    <!-- Gruppen-Cards Grid -->
    <div class="groups-grid">
      @if (stakeholderGroups().length > 0) {
        @for (group of stakeholderGroups(); track group.id) {
          <mat-card class="group-card" (click)="navigateToGroupDetail(group.id)">
            <div class="group-card-header">
              <mat-icon class="group-icon">{{ group.icon }}</mat-icon>
              <span class="status-badge" [class]="getStatusBadgeClass(group.status)">
                {{ getStatusBadgeText(group.status) }}
              </span>
            </div>
            <div class="group-card-content">
              <h3 class="group-title">{{ group.name }}</h3>
              <p class="group-subtitle">{{ group.participantCount }} Personen · {{ getImpactText(group.impact) }}</p>
              <div class="group-dots">
                <div class="dot-group">
                  <span class="dot promoter-dot"></span>
                  <span class="dot-count">{{ group.promoters }}</span>
                </div>
                <div class="dot-group">
                  <span class="dot neutral-dot"></span>
                  <span class="dot-count">{{ group.neutrals }}</span>
                </div>
                <div class="dot-group">
                  <span class="dot critic-dot"></span>
                  <span class="dot-count">{{ group.critics }}</span>
                </div>
              </div>
              <div class="group-readiness">
                <span class="readiness-value">{{ group.readiness }}%</span>
                <span class="trend-indicator" [class]="getTrendClass(group.trend)">
                  <mat-icon class="trend-icon">{{ getTrendIcon(group.trend) }}</mat-icon>
                  {{ formatTrend(group.trend) }}
                </span>
              </div>
            </div>
            <div class="group-card-footer">
              <mat-icon class="arrow-icon">arrow_forward</mat-icon>
            </div>
          </mat-card>
        }
      } @else {
        <div class="empty-groups-message">
          <p>Noch keine Stakeholder-Gruppen verfügbar</p>
        </div>
      }
    </div>
      }
    </div>
  }
</div>

